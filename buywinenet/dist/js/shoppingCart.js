"use strict";$(function(){function c(n){var e=(1*n.parent().prev().prev().text().substring(2)*(1*n.parent().find("input").val())).toFixed(2);n.parent().next().html("￥ "+e),i()}$("#cart").on("click",".addnum",function(n){var e=$(this).prev().val();e++;var t=1*$(this).parent().siblings(".good_num").find("a").html();t<=e&&(e=t),$(this).prev().val(e),c($(this))}),$("#cart").on("click",".cutnum",function(){var n=$(this).next().val();--n<=1&&(n=1),$(this).next().val(n),c($(this))}),$("#cart").on("click",".good_del",function(){var n=$(this).parent().attr("data-id");confirm("你确定要删除吗？")&&($(this).parent().remove(),s(),i(),$.ajax({type:"post",url:"../api/shopcar.php",data:{thisid:n,m:"thisdel"},success:function(n){}}))}),$("#cart").on("click",".good_check input",function(){i()});var o=[],a=[];function i(){o=[],a=[];for(var n=0;n<$(".good_check input").size();n++)$(".good_check input").eq(n).prop("checked")&&(o.push(n),a.push($("#cart .carlist").eq(n).attr("data-id")));var e=0,t=0;for(n=0;n<o.length;n++)t+=1*$(".nownum").eq(o[n]).val(),e+=1*$(".good_total").eq(o[n]).text().substring(2);$("#allnum").html("购物车 <em>"+t+"</em> 件").find("em").css("color","red"),$("#totalprice").html("  应付商品金额(不含运费)：<em>￥"+e.toFixed(2)+"</em > "),o.length==$(".good_check input").size()?$("#allchecked input").prop("checked","checked"):$("#allchecked input").removeAttr("checked")}function n(){for(var n=confirm("您真的不要我了吗？"),e=0;e<a.length;e++)$.ajax({type:"post",url:"../api/shopcar.php",data:{thisid:a[e],m:"thisdel"},success:function(n){}});if(n)for(var t=o.length-1;0<=t;t--)$("#cart .carlist").eq(o[t]).remove(),s(),i()}$("#allchecked input").on("click",function(){$(this).prop("checked")?$(".good_check input").prop("checked","checked"):$(".good_check input").removeAttr("checked"),i()}),$("#delall").on("click",function(){n()}),$("#clearall").on("click",function(){n()}),$("#cart").on("input",".nownum",function(){c($(this)),i()}),$.cookie("phoneNumber")&&$(".login").html("你好！"+$.cookie("phoneNumber")).attr("href","javascript:void(0)"),window.onbeforeunload=function(){window.event.screenX-window.screenLeft>document.documentElement.scrollWidth-20&&window.event.clientY<0||window.event.altKey?$.cookie("phoneNumber","",{expires:-1,path:"/"}):$.cookie("phoneNumber",phone,{path:"/"})},$(".gotobuy").click(function(){$.cookie("phoneNumber")?alert("用户已经登录"):window.location.href="../html/userLogin.html"});var t=$("#cart");function s(){0==$(".good_name").size()&&($("#del").css("display","none"),$(".gotobuy").css("background","#ccc"))}$.ajax({type:"post",url:"../api/shopcar.php",data:{m:"shopcar"},success:function(n){var e=JSON.parse(n).map(function(n){return'\n            <li class="carlist" data-id= '+n.id+'>\n            <p class="good_check"><input type="checkbox" name="good" value="" /></p>\n            <p class="good_name">\n                <img src="'+n.img+'" style="width:40px;height:40px;">\n                '+n.name+'\n            </p>\n            <p class="good_price">￥&nbsp;'+n.price+'</p>\n            <p class="good_bargin">-</p>\n            <p class="num">\n                <span class="cutnum">-</span>\n                <input class="nownum" type="text" value="'+n.qty+'" />\n                <span class="addnum">+</span>\n            </p>\n            <p class="good_total">￥&nbsp;'+(n.price*n.qty).toFixed(2)+'</p>\n\n            <p class="good_del">\n                <a href="javascript:;">删除</a>\n            </p>\n            <p class="good_num">\n                <a href="javascript:;">'+n.inventory+"</a>\n            </p>\n        </li>\n            "}).join("");t.html(e),0==$(".good_name").size()&&($("#del").css("display","none"),$(".gotobuy").css("background","#ccc"))}})});